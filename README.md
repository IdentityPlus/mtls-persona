# mtls-persona
An mTLS ID Facade for non-mTLS capable (TCP) applications


## Introduction

mTLS Persona is a small tool that transforms a non TLS communication into a TLS communication. The principle of operation is relatively simple, it operates as a TCP forwarder, such that the inboud traffic is a plain-text TCP communciation, and the outbound traffic is standard TLS encrypted TCP communication. In particular, mTLS persona is a utility applciation specific to the Identity Plus ecosystem to help enable mutually authenticated TLS between any two client / service applications use-cases, whether there is native TLS support in the peer application or not. As such, mTLS Persona is works by wrapping communication into a mutually authenticated TLS communication channel, instead of a simple TLS channel, therefore it operates using a client certificate / private key pair, to authenticate itself to the receiving end of the TLS communication, and, it is validating the server TLS certiciate against a trust chain. 

mTLS Persona is not a complete forward proxy solution, in the sense that it does not allow the client end of the communication to control the destination end, rather, it forces the client through a predefined channel which is pre-defined in the configuration panel. This, however, is specific feature, not a bug, designed to circumvent the need for any sort of "buy in" from the client application. Forwards proxies, such as SOCKS require the client to be aware of the SOCKS protocol and decorate the TCP/TLS communication with additional information which tells the SOCKS proxy where to open the outbound coonection to. This however represents a limitation in certain implementations because not all applications support such protocol, and if they do, code changes or at least configuration changes must be enforced, which sometimes is difficult. mTLS Persona on the other hand, completely fools the client to believing that it in fact communicates with a local service over plain text TCP, whereas in fact, the communication is not only secured, but also authenticated, once it leaves the local premises of the client. In this sens, from an Identity Plus identity principles perspective, it shall be considered that mTLS Persona is part of the "perimeter of one" of the client, as in, it is part of the client from a topology and logical perspective, as the mTLS Persona component gives identity to the underlying, non-cooperating, client application.

mTLS Persona is designed with high performance in mind. It is a highly threaded application, working event based. It only opens connection to remote destinations if it receives an inbound request and it is aware to close corresponding  connections if one of the peers closes their connection. As such, it will not keep alive, unnecessarily, TCP connections to services. It is normal to expect that mTLS Persona will increase the latency of the connection, as it transforms a non-TLS connection into a mutual-TLS connection which, as a protocol, requires additional roundtrips between peers. Once the connection has been established however, no additional latency should be obsereved, as the upstream connection is kept open as long as peers consider it necessary. During packet transmission there may be additional compute resources necessary to encrypt the communication. On machines where symmetric encryption is hardware accelerated, this will not impact the rest of the compute. Generally speaking, the impact of encryption is tiny, and should not be noticeable unless we are talking about extremely low powered systems or extremely low margins for compute induced latency, nanoseconds.  

## Operating Principle

                         
                          mTLS Persona                       mTLS Gateway
      TCP Client       \--------------------          --------------------/
    ----------------->   local:port -------     ...    ------ remote:port  --------------> TCP Service
                       /--------------------          --------------------\